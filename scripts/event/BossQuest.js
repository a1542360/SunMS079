/* ==================
 脚本类型: 脚本
 版权：游戏盒团队     
 联系扣扣：297870163    609654666
 =====================
 */importPackage(java.lang);var monster,mapid=551030200;monster=[322E4,9300003,4130103,9300012,8220001,822E4,9300119,9300152,9300039,9300032,9300028,9400549,8180001,818E4,8500001,9400014,9420544,9420549,9400121,9400300];function init(){}function monsterValue(a,b){return 1}function setup(a){a=em.newInstance("BossQuest"+a);a.createInstanceMap(mapid).toggleDrops();a.setProperty("points",0);a.setProperty("monster_number",0);a.schedule("beginQuest",5E3);return a}function playerEntry(a,b){var c=a.getMapInstance(mapid,0);b.changeMap(c,c.getPortal(0))}function playerDead(a,b){}function playerRevive(a,b){b.setHp(b.getMaxHp());playerExit(a,b);return!1}function playerDisconnected(a,b){return 0}function leftParty(a,b){playerExit(a,b)}function disbandParty(a){for(var b=a.getPlayers(),c=0;c<b.size();c++)playerExit(a,b.get(c))}function playerExit(a,b){var c=!1;1==a.getPlayers().size()&&(c=!0);a.saveBossQuestPoints(parseInt(a.getProperty("points")),b);a.broadcastPlayerMsg(6,"[BossPQ] \u60a8\u76ee\u524d\u7684\u79ef\u5206\u5df2\u7ecf\u83b7\u5f97\uff0c\u5982\u4f60\u6240\u613f\u3002\u66f4\u597d\u7684\u8fd0\u6c14\u4e0b\u4e00\u6b21\uff01");a.unregisterPlayer(b);c&&a.dispose()}function removePlayer(a,b){var c=!1;1==a.getPlayers().size()&&(c=!0);a.saveBossQuestPoints(parseInt(a.getProperty("points")),b);a.unregisterPlayer(b);b.getMap().removePlayer(b);c&&a.dispose()}function clearPQ(a){for(var b=a.getPlayers(),c=0;c<b.size();c++)playerExit(a,b.get(c))}function allMonstersDead(a){var b=parseInt(a.getProperty("monster_number")),c=parseInt(a.getProperty("points")),d=java.lang.System.currentTimeMillis(),d=Math.round((d-parseInt(a.getProperty("monster_start")))/1E3),c=0>=3600-d?c+1E4*b:c+(1E4*b+(3600-d)*(b+1));b++;a.setProperty("points",c);a.setProperty("monster_number",b);d=a.getMapInstance(mapid,0);19<b?(d.broadcastMessage(tools.MaplePacketCreator.serverNotice(6,"[BOSS\u4efb\u52a1]\u606d\u559c\uff01\u4f60\u7684\u56e2\u961f\u5df2\u7ecf\u51fb\u8d25\u6240\u6709\u7684\u8001\u677f\u4e0e "+c+" \u70b9!")),d.broadcastMessage(tools.MaplePacketCreator.serverNotice(6,"[BOSS\u4efb\u52a1]\u79ef\u5206\u5df2\u7ecf\u5956\u52b1\uff0c\u4f60\u613f\u610f\u82b1\u8d39\u4ed6\u4eec.")),disbandParty()):(d.broadcastMessage(tools.MaplePacketCreator.serverNotice(6,"[BOSS\u4efb\u52a1] \u4f60\u7684\u56e2\u961f\u73b0\u5728\u6709 "+c+" \u5206\uff01\u63a5\u4e0b\u6765\u7684BOSS\u4f1a\u572810\u79d2\u5185\u4ea7\u5375.")),d.broadcastMessage(tools.MaplePacketCreator.getClock(10)),a.schedule("monsterSpawn",1E3))}function monsterSpawn(a){var b=em.getMonster(monster[parseInt(a.getProperty("monster_number"))]),c=new server.life.MapleMonsterStats;14<parseInt(a.getProperty("monster_number"))?c.setHp(b.getHp()/2):c.setHp(2*b.getHp());c.setExp(b.getExp());c.setMp(b.getMaxMp());b.setOverrideStats(c);14<parseInt(a.getProperty("monster_number"))?b.setHp(b.getHp()/2):b.setHp(2*b.getHp());a.registerMonster(b);a.getMapInstance(mapid,0).spawnMonsterOnGroundBelow(b,new java.awt.Point(100,100));a.setProperty("monster_start",java.lang.System.currentTimeMillis())}function beginQuest(a){var b=a.getMapInstance(mapid,0);b.broadcastMessage(tools.MaplePacketCreator.serverNotice(6,"[BOSS\u4efb\u52a1]\u9ed1\u6697\u4e2d\u7684\u751f\u7269\u90fd\u572830\u79d2\u5230\u6765\u3002\u51c6\u5907\u6700\u574f\u7684\u6253\u7b97!"));a.schedule("monsterSpawn",3E4);b.broadcastMessage(tools.MaplePacketCreator.getClock(30))}function cancelSchedule(){};