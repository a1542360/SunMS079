/**
	魔法森林搭船系統改寫 by:Kodan
**/importPackage(Packages.client);importPackage(Packages.tools);importPackage(Packages.tools.packet);importPackage(Packages.server.life);var closeTime=12E4,beginTime=12E4,rideTime=6E5,invasionTime=3E5,Orbis_btf,Boat_to_Orbis,Orbis_Boat_Cabin,Orbis_docked,Ellinia_btf,Ellinia_Boat_Cabin,Ellinia_docked;function init(){Orbis_btf=em.getChannelServer().getMapFactory().getMap(200000112);Ellinia_btf=em.getChannelServer().getMapFactory().getMap(101000301);Boat_to_Orbis=em.getChannelServer().getMapFactory().getMap(200090010);Boat_to_Ellinia=em.getChannelServer().getMapFactory().getMap(20009E4);Orbis_Boat_Cabin=em.getChannelServer().getMapFactory().getMap(200090011);Ellinia_Boat_Cabin=em.getChannelServer().getMapFactory().getMap(200090001);Orbis_docked=em.getChannelServer().getMapFactory().getMap(200000100);Ellinia_docked=em.getChannelServer().getMapFactory().getMap(101000300);Orbis_Station=em.getChannelServer().getMapFactory().getMap(200000111);OBoatsetup();EBoatsetup();scheduleNew()}function scheduleNew(){Ellinia_docked.setDocked(!0);Orbis_Station.setDocked(!0);Ellinia_docked.broadcastMessage(CField.boatPacket(!0));Orbis_Station.broadcastMessage(CField.boatPacket(!0));em.setProperty("docked","true");em.setProperty("entry","true");em.setProperty("haveBalrog","false");em.setProperty("haveBalrog1","false");try{em.schedule("stopentry",closeTime),em.schedule("takeoff",beginTime)}catch(a){}}function stopentry(){em.setProperty("entry","false");Orbis_Boat_Cabin.resetReactors();Ellinia_Boat_Cabin.resetReactors()}function takeoff(){em.setProperty("docked","false");for(var a=Orbis_btf.getCharacters().iterator();a.hasNext();)a.next().changeMap(Boat_to_Ellinia,Boat_to_Ellinia.getPortal(0));for(a=Ellinia_btf.getCharacters().iterator();a.hasNext();)a.next().changeMap(Boat_to_Orbis,Boat_to_Orbis.getPortal(0));Ellinia_docked.setDocked(!1);Orbis_Station.setDocked(!1);Ellinia_docked.broadcastMessage(CField.boatPacket(!1));Orbis_Station.broadcastMessage(CField.boatPacket(!1));try{em.schedule("invasion",invasionTime),em.schedule("arrived",rideTime)}catch(b){}}function arrived(){for(var a=Boat_to_Orbis.getCharacters().iterator();a.hasNext();)a.next().changeMap(Orbis_docked,Orbis_docked.getPortal(0));for(a=Orbis_Boat_Cabin.getCharacters().iterator();a.hasNext();)a.next().changeMap(Orbis_docked,Orbis_docked.getPortal(0));for(a=Boat_to_Ellinia.getCharacters().iterator();a.hasNext();)a.next().changeMap(Ellinia_docked,Ellinia_docked.getPortal(0));for(a=Ellinia_Boat_Cabin.getCharacters().iterator();a.hasNext();)a.next().changeMap(Ellinia_docked,Ellinia_docked.getPortal(0));Boat_to_Orbis.killAllMonsters(!1);Boat_to_Ellinia.killAllMonsters(!1);scheduleNew()}function invasion(){var a;a=Math.floor(10*Math.random());a=4>=a?0:5==a?1:2;if(2==a){for(var b=0;b<a;b++)Boat_to_Orbis.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(815E4),new java.awt.Point(485,-221)),Boat_to_Ellinia.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(815E4),new java.awt.Point(-590,-221));Boat_to_Orbis.setDocked(!0);Boat_to_Ellinia.setDocked(!0);Boat_to_Orbis.broadcastMessage(CField.boatEffect(1034));Boat_to_Ellinia.broadcastMessage(CField.boatEffect(1034));Boat_to_Orbis.broadcastMessage(CField.musicChange("Bgm04/ArabPirate"));Boat_to_Ellinia.broadcastMessage(CField.musicChange("Bgm04/ArabPirate"));em.setProperty("haveBalrog","true")}else 1==a&&(Boat_to_Orbis.setDocked(!0),Boat_to_Ellinia.setDocked(!0),Boat_to_Orbis.broadcastMessage(CField.boatEffect(1034)),Boat_to_Ellinia.broadcastMessage(CField.boatEffect(1034)),Boat_to_Orbis.broadcastMessage(CField.musicChange("Bgm04/ArabPirate")),Boat_to_Ellinia.broadcastMessage(CField.musicChange("Bgm04/ArabPirate")),em.setProperty("haveBalrog1","true"))}function OBoatsetup(){em.getChannelServer().getMapFactory().getMap(200090011).getPortal("out00").setScriptName("OBoat1");em.getChannelServer().getMapFactory().getMap(200090011).getPortal("out01").setScriptName("OBoat2")}function EBoatsetup(){em.getChannelServer().getMapFactory().getMap(200090001).getPortal("out00").setScriptName("EBoat1");em.getChannelServer().getMapFactory().getMap(200090001).getPortal("out01").setScriptName("EBoat2")}function cancelSchedule(){};