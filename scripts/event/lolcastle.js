/* ==================
 脚本类型: 脚本
 版权：游戏盒团队     
 联系扣扣：297870163    609654666
 =====================
 */var i=5,mapId=270050100,returnMap,setupTask;function init(){em.setProperty("entryPossible","false");scheduleNew()}function scheduleNew(){var c=java.util.Calendar.getInstance();c.set(java.util.Calendar.HOUR,3);c.set(java.util.Calendar.MINUTE,50);c.set(java.util.Calendar.SECOND,0);for(c=c.getTimeInMillis();c<=java.lang.System.currentTimeMillis();)c+=144E5;setupTask=em.scheduleAtTimestamp("setup",c)}function cancelSchedule(){setupTask.cancel(!0)}function setup(){em.setProperty("entryPossible","false");returnMap=em.getChannelServer().getMapFactory().getMap(101E6);var c=["lolcastle1","lolcastle2","lolcastle3","lolcastle4","lolcastle5"],d;for(d=0;d<c.length;d++)em.newInstance(c[d]).createInstanceMap(mapId).toggleDrops();for(d=0;5>d;d++)em.schedule("announce",3E5+6E4*d);em.schedule("mesoDistribution",3E5+6E4*d);em.schedule("start",3E5+6E4*(d+1));em.schedule("timeOut",186E4)}function announce(){em.setProperty("entryPossible","true");0==i&&(i=5);em.getChannelServer().broadcastPacket(tools.MaplePacketCreator.serverNotice(6,"[\u4e8b\u4ef6] \u5ba1\u5224\u73b0\u573a\u5c06\u6253\u5f00 "+i+" \u5206\u949f"));i--}function mesoDistribution(){em.setProperty("entryPossible","false");for(var c=em.getInstances().iterator();c.hasNext();){var d=c.next();if(0<d.getPlayerCount()){var b=5E5*d.getPlayerCount(),a=Math.floor(Math.random()*d.getPlayerCount()),a=d.getPlayers().get(a);d.getMapInstance(mapId).broadcastMessage(tools.MaplePacketCreator.serverNotice(6,"[\u4e8b\u4ef6] "+a.getName()+" \u80dc "+b+" \u91d1\u5e01"));a.gainMeso(b,!0,!0,!0)}}}function start(){scheduleNew();em.getChannelServer().broadcastPacket(tools.MaplePacketCreator.serverNotice(6,"[\u4e8b\u4ef6]\u5224\u51b3\u4e66\u573a\u73b0\u5df2\u5f00\u653e"));for(var c=em.getInstances().iterator();c.hasNext();){var d=c.next();0<d.getPlayerCount()&&startInstance(d)}}function randX(){return-600+Math.floor(1800*Math.random())}function startInstance(c){if(0<c.getPlayerCount()){for(var d=c.getPlayers().iterator();d.hasNext();)d.next().getClient().getSession().write(tools.MaplePacketCreator.getClock(1200));d=c.getMapInstance(mapId);if(c.getName().equals("lolcastle1")){for(var b=0;100>b;b++){var a=em.getMonster(9500169),e=new server.life.MapleMonsterStats;e.setHp(3*a.getHp());e.setExp(a.getExp()/4);e.setMp(a.getMaxMp());a.setOverrideStats(e);a.setHp(3*a.getHp());c.registerMonster(a);d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100))}for(b=0;10>b;b++)a=em.getMonster(9300136),e=new server.life.MapleMonsterStats,e.setHp(15E3),e.setExp(a.getExp()),e.setMp(a.getMaxMp()),a.setOverrideStats(e),a.setHp(15E3),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100))}else if(c.getName().equals("lolcastle2")){for(b=0;100>b;b++)a=em.getMonster(512E4),e=new server.life.MapleMonsterStats,e.setHp(3E4),e.setExp(a.getExp()/4),e.setMp(a.getMaxMp()),a.setOverrideStats(e),a.setHp(3E4),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100));for(b=0;3>b;b++)a=em.getMonster(9300012),e=new server.life.MapleMonsterStats,e.setHp(a.getHp()),e.setExp(a.getExp()),e.setMp(a.getMaxMp()),a.setOverrideStats(e),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100))}else if(c.getName().equals("lolcastle3")){for(b=0;100>b;b++)a=33>b?7130400:66>b?7130401:7130402,a=em.getMonster(a),e=new server.life.MapleMonsterStats,e.setHp(2*a.getHp()),e.setExp(a.getExp()/4),e.setMp(a.getMaxMp()),a.setOverrideStats(e),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100));for(b=0;3>b;b++)a=em.getMonster(9300105),e=new server.life.MapleMonsterStats,e.setHp(a.getHp()),e.setExp(a.getExp()/4),e.setMp(a.getMaxMp()),a.setOverrideStats(e),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100))}else if(c.getName().equals("lolcastle4"))for(b=0;78>b;b++)a=25>b?7130010:50>b?7130001:75>b?9500134:9300039,a=em.getMonster(a),e=new server.life.MapleMonsterStats,75<=b?(e.setExp(a.getExp()),e.setHp(a.getHp())):(e.setExp(a.getExp()/4),e.setHp(2*a.getHp())),e.setMp(a.getMaxMp()),a.setOverrideStats(e),75>b?a.setHp(2*a.getHp()):a.setHp(a.getHp()),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100));else if(c.getName().equals("lolcastle5")){for(b=0;90>b;b++)a=30>b?8141100:60>b?8140600:8150100,a=em.getMonster(a),e=new server.life.MapleMonsterStats,e.setHp(a.getHp()),e.setExp(a.getExp()/4),e.setMp(a.getMaxMp()),a.setOverrideStats(e),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100));for(b=0;3>b;b++)a=em.getMonster(9300152),e=new server.life.MapleMonsterStats,e.setHp(2E6),e.setExp(a.getExp()),e.setMp(a.getMaxMp()),a.setOverrideStats(e),a.setHp(2E6),c.registerMonster(a),d.spawnMonsterOnGroundBelow(a,new java.awt.Point(randX(),100))}}}function monsterValue(c,d){switch(d){case 9300152:return 15;case 9300039:return 15;case 9300105:return 15;case 9300012:return 15;case 9300136:return 5;default:return 1}}function playerEntry(c,d){var b=c.getMapInstance(mapId);d.changeMap(b,b.getPortal(0))}function playerDead(c,d){d.setHp(1);d.changeMap(returnMap,returnMap.getPortal(0));c.unregisterPlayer(d);d.getClient().getSession().write(tools.MaplePacketCreator.serverNotice(1,"\u4f60\u5931\u53bb\u4e86\u4e0e "+c.getKillCount(d)+" \u70b9."))}function playerDisconnected(c,d){c.unregisterPlayer(d);d.getMap().removePlayer(d);d.setMap(returnMap)}function allMonstersDead(c){if(1<c.getPlayerCount())for(var d=0,b=null,a=c.getPlayers().iterator();a.hasNext();){var e=a.next();c.getKillCount(e)<=d?playerDead(c,e):c.getKillCount(e)>d&&(null!=b&&playerDead(c,b),b=e,d=c.getKillCount(b))}d=c.getMapInstance(mapId);a=server.MapleItemInformationProvider.getInstance();b=1+Math.floor(100*Math.random());if(35>=b){do b=1702E3+Math.floor(176*Math.random());while(0==a.getSlotMax(b));b=a.getEquipById(b)}else 35<b&&37>=b?(b=c.getName().equals("lolcastle1")||c.getName().equals("lolcastle2")?[1452008,1472021,1462007,1332054,1312008,1322021,1302010,1442046,1432004,1382011,1412003,1422005,1402013,1372011]:[1452019,1472053,1462015,1332051,1312030,1322045,1302056,1442044,1432030,1382035,1412021,1422027,1402037,1372010,1302026,1102041],b=b[Math.floor(Math.random()*b.length)],b=a.randomizeStats(a.getEquipById(b))):37<b&&45>=b?(b=c.getName().equals("lolcastle1")||c.getName().equals("lolcastle2")?[2040009,2040011,2040309,2040405,2040409,2040511,2040605,2040607,2040609,2040611,2040713,2040717,2040809,2040813,2040905,2040909,2041027,2041029,2041031,2041033,2041034,2041036,2041038,2041040,2043004,2043104,2043204,2043304,2043704,2043804,2044004,2044104,2044204,2044304,2044404,2044504,2044604,2044704]:[2040013,2040015,2040307,2044705,2044505,2043305,2044605,2040407,2040411,2040907,2041035,2041037,2041039,2041041,2043105,2044105,2043205,2044205,2043005,2044005,2044405,2044305,2043805,2043705,2040715,2040509,2040519,2040521,2040811,2040815,2040305,2040917,2040922,2043007],a=Math.floor(Math.random()*b.length),b=new client.Item(b[a],0,1,0)):45<b&&70>=b?(a=[[2022273,3],[2022245,3],[2022179,1]],b=Math.floor(Math.random()*a.length),b=new client.Item(a[b][0],0,a[b][1],0)):70<b&&75>=b?b=new client.Item(2070003+Math.floor(14*Math.random()),0,1,0):(b=75<b&&95>=b?[2044701,2044501,2043301,2044601,2043101,2044101,2043201,2044201,2043001,2044001,2044401,2044301,2043801,2043701,2040704,2040501,2040513,2040516,2040804,2040801,2040301]:[2040315,2040912,2040313,2043108,2043208,2043308,2043708,2043808,2044008,2044108,2044208,2044308,2044408,2044508,2044608,2044708],a=Math.floor(Math.random()*b.length),b=new client.Item(b[a],0,1,0));for(a=c.getPlayers().iterator();a.hasNext();)e=a.next(),e.getClient().getSession().write(tools.MaplePacketCreator.serverNotice(1,"\u4f60\u8d62\u4e86\u4e0e "+c.getKillCount(e)+" \u70b9. \u60a8\u5c06\u57282\u5206\u949f\u5185\u88ab\u4f20\u9001\u4e86.")),e.getClient().getSession().write(tools.MaplePacketCreator.getClock(120)),c.saveWinner(e);e=c.getPlayers().get(0);d.spawnItemDrop(e,e,b,e.getPosition(),!0,!1);c.schedule("warpWinnersOut",12E4)}function timeOut(){for(var c=em.getInstances().iterator();c.hasNext();){var d=c.next();if(0<d.getPlayerCount())for(var b=d.getPlayers().iterator();b.hasNext();)playerDead(d,b.next());d.dispose()}}function warpWinnersOut(c){for(var d=c.getPlayers().iterator();d.hasNext();){var b=d.next();b.changeMap(returnMap,returnMap.getPortal(0));c.unregisterPlayer(b)}c.dispose()}function leftParty(c,d){}function disbandParty(c,d){}function playerRevive(c,d){};