/* ==================
 脚本类型: 脚本
 版权：游戏盒团队     
 联系扣扣：297870163    609654666
 =====================
 */importPackage(java.lang);var mapz=[0,100,200,300,301,400,401,410,420,430,431,440,500,501,502,600,610,611,620,630,631,640,641,700,800,900,1E3,1100,1101];function init(){em.setProperty("started","false");em.setProperty("state","0");em.setProperty("guildid","-1")}function monsterValue(a,b){return-1}function setup(a){setup()}function setup(){em.setProperty("guildid","-1");em.setProperty("started","false");em.setProperty("state","0");var a=em.newInstance("GuildQuest");a.setProperty("canEnter","false");for(var b=a.getMapFactory(),c=0;c<mapz.length;c++){var d=a.setInstanceMap(99E7+mapz[c]);null!=d&&d.resetFully()}b.getMap(990000501).shuffleReactors();b.getMap(990000502).shuffleReactors();b.getMap(990000611).getReactorByName("").setDelay(-1);b.getMap(990000620).getReactorByName("").setDelay(-1);b.getMap(990000631).getReactorByName("").setDelay(-1);b.getMap(990000641).getReactorByName("").setDelay(-1);b.getMap(99E7).getPortal(5).setScriptName("guildwaitingenter");a.startEventTimer(18E4);a.setProperty("entryTimestamp",System.currentTimeMillis());return a}function scheduledTimeout(a){if(em.getProperty("state").equals("0")){if(em.setProperty("state","1"),!disposePlayerBelow(a,2,990001100,"\u4f60\u81f3\u5c11\u9700\u89813\u4e2a\u4eba\u6765\u5f00\u59cb\u5bb6\u65cf\u4efb\u52a1.")){for(var b=players(a).iterator();b.hasNext();)b.next().dropMessage(5,"\u5bb6\u65cf\u4efb\u52a1\u5df2\u7ecf\u5f00\u59cb\u4e86.");em.setProperty("started","true");a.setProperty("canEnter","true");a.restartEventTimer(36E5)}}else em.getProperty("state").equals("1")?disposePlayerBelow(a,100,990001100,"\u65f6\u95f4\u5df2\u7ecf\u7528\u5b8c\uff0c\u5bb6\u65cf\u4efb\u52a1\u5c06\u7ed3\u675f."):em.getProperty("state").equals("2")&&finish(a)}function playerEntry(a,b){var c=em.getMapFactory().getMap(99E7);b.changeMap(c,c.getPortal(0))}function playerRevive(a,b){return!1}function playerDead(a,b){}function disposePlayerBelow(a,b,c,d){var e=players(a),f=a.getMapFactory().getMap(c);if(e.size()<=b){for(b=e.iterator();b.hasNext();)e=b.next(),a.unregisterPlayer(e),0<c&&e.changeMap(f,f.getPortal(0)),0<d.length&&e.dropMessage(6,d);em.setProperty("started","false");a.dispose();return!0}return!1}function players(a){for(var b=em.newCharList(),c=0;c<mapz.length;c++){var d=a.getMapFactory().getMap(99E7+mapz[c]);if(null!=d)for(d=d.getCharactersThreadsafe().iterator();d.hasNext();){var e=d.next();(""+e.getGuildId()).equals(a.getProperty("guildid"))&&null!=e.getEventInstance()&&e.getEventInstance().getName().equals("GuildQuest")&&b.add(e)}}return b}function changedMap(a,b,c){if(99E7>c||990002E3<c)a.unregisterPlayer(b),b.getName().equals(a.getProperty("leader"))?disposePlayerBelow(a,100,990001100,"\u5bb6\u65cf\u4efb\u52a1\u7684\u961f\u957f\u5df2\u7ecf\u79bb\u5f00\u4e86\uff0c\u5bfc\u81f4\u5269\u4f59\u7684\u73a9\u5bb6\u88ab\u4f20\u9001\u56de\u53bb."):disposePlayerBelow(a,0,0,"")&&em.setProperty("started","false")}function playerDisconnected(a,b){a.unregisterPlayer(b);b.getName().equals(a.getProperty("leader"))?disposePlayerBelow(a,100,990001100,"\u5bb6\u65cf\u4efb\u52a1\u7684\u961f\u957f\u5df2\u7ecf\u65ad\u5f00\uff0c\u5bfc\u81f4\u5269\u4f59\u7684\u73a9\u5bb6\u88ab\u4f20\u9001\u56de\u53bb."):em.getProperty("state").equals("0")||disposePlayerBelow(a,2,990001100,"\u6ca1\u6709\u8db3\u591f\u7684\u961f\u5458\u7ee7\u7eed\u5bb6\u65cf\u7684\u4efb\u52a1\uff0c\u8fd9\u610f\u5473\u7740\u5176\u4f59\u7684\u961f\u5458\u5c06\u88ab\u4f20\u9001\u51fa\u53bb.")}function leftParty(a,b){}function disbandParty(a){}function playerExit(a,b){a.unregisterPlayer(b);em.getProperty("state").equals("0")||disposePlayerBelow(a,2,990001100,"\u6ca1\u6709\u8db3\u591f\u7684\u961f\u5458\u7ee7\u7eed\u5bb6\u65cf\u7684\u4efb\u52a1\uff0c\u8fd9\u610f\u5473\u7740\u5176\u4f59\u7684\u961f\u5458\u5c06\u88ab\u4f20\u9001\u51fa\u53bb.")}function clearPQ(a){var b=a.getPlayers().iterator(),c=a.getMapFactory().getMap(990001E3);for(c.resetReactors();b.hasNext();){var d=b.next();d.changeMap(c,c.getPortal(0));d.modifyCSPoints(1,4E3,!0)}em.setProperty("state","2");a.restartEventTimer(12E4)}function finish(a){disposePlayerBelow(a,100,990001100,"")}function allMonstersDead(a){}function cancelSchedule(){}function timeOut(){};